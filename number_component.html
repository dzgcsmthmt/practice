<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0,user-scalable=no" />
    <script>
		(function(){
			var html = document.documentElement;
			var htmlWidth = html.getBoundingClientRect().width;
			html.style.fontSize = htmlWidth / 15 +"px";
		})();
	</script>
    <style media="screen">
        html,body{
            height: 100%;
        }
        :focus{
            outline: none;
        }
        .num-wrapper{
            font-size: 0;
        }
        .num-wrapper i{
            display: inline-block;
            width: 1.9rem;
            height: 1.9rem;
            box-sizing: border-box;
            border: 1px solid #eaeaea;
        }
        .num-wrapper i.disabled{
            border-color: #eee;
        }
        .num-wrapper i:nth-of-type(1){
            border-radius: 4px 0 0 4px;
            border-right: 0;
        }
        .num-wrapper i:nth-of-type(2){
            border-radius: 0 4px 4px 0;
            border-left: 0;
        }
        .num-wrapper i.icon-plus{
            background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABEAQMAAAAC3QHxAAAABlBMVEUAAAC3t7eb908KAAAAAXRSTlMAQObYZgAAAB1JREFUKM9jGAKA8ccgZP0Hgg+kswaJ61FZQwAAAAHEOrdA/WPUAAAAAElFTkSuQmCC') no-repeat;
            background-size: 100%;
        }
        .num-wrapper i.icon-plus.disabled{
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABEAQMAAAAC3QHxAAAABlBMVEUAAADu7u6BVFV4AAAAAXRSTlMAQObYZgAAAB1JREFUKM9jGAKA8ccgZP0Hgg+kswaJ61FZQwAAAAHEOrdA/WPUAAAAAElFTkSuQmCC') no-repeat;
            background-size: 100%;
        }
        .num-wrapper i.icon-minus{
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABEAQMAAAAC3QHxAAAABlBMVEUAAAC3t7eb908KAAAAAXRSTlMAQObYZgAAABZJREFUKM9jGAWUgv9A8IEM1iggAQAAFuYdicsWPbYAAAAASUVORK5CYII=') no-repeat;
            background-size: 100%;
        }
        .num-wrapper i.icon-minus.disabled{
            background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEQAAABEBAMAAADKPY6BAAAAMFBMVEUAAADu7u7s7Ozy8vLk5OTs7Ozy8vLk5OTs7Ozs7Ozy8vLy8vLk5OTk5OTu7u7t7e2mlTPGAAAADnRSTlMAvuF7SvlbUqiliog3NokSb+YAAAA6SURBVEjHYxgFo2AUjAIaAzZBdCBxAE0J1793aOBpAZoSZgwljxxoooSbsFswfSR5gWEUjIJRMEIBAANGWZQuZ3hMAAAAAElFTkSuQmCC') no-repeat;
            background-size: 100%;
        }
        .num-wrapper input{
            width: 3rem;
            height: 1.9rem;
            vertical-align: top;
            border: 1px solid #eaeaea;
            box-sizing: border-box;
            text-align: center;
            font-size: 0.8rem;
        }
    </style>
</head>

<body>
    <div id="modal">

    </div>

    <div class="num-wrapper">
        <!-- <i class="icon icon-minus disabled"></i>
        <input type="tel" class="num" value="1" maxlength="5">
        <i class="icon icon-plus"></i> -->
    </div>
    <br>
    <br>
    <div class="num-wrapper">
    </div>
    <script>

        function NumCom(options){
            this.options = {
                MIN: 1,
                MAX: 99999,
                step: 1,
                initValue: 1,
                wrapper: document.body
            }
            Object.assign(this.options,options);
            this.init();
        }

        NumCom.prototype.init = function(){
            this.render();
            this.bindEvent();
        }

        NumCom.prototype.render = function(){
            var fragment = document.createDocumentFragment();
            this.oI1 = document.createElement('i');
            this.oI1.className = 'icon icon-minus disabled';
            fragment.appendChild(this.oI1);
            this.oInput = document.createElement('input');
            this.oInput.setAttribute('type','tel');
            this.oInput.setAttribute('value',this.options.initValue);
            this.oInput.setAttribute('maxlength',String(this.options.MAX).length);
            this.oInput.className = 'num';
            fragment.appendChild(this.oInput);
            this.oI2 = document.createElement('i');
            this.oI2.className = 'icon icon-plus';
            fragment.appendChild(this.oI2);
            this.options.wrapper.appendChild(fragment);
            this.oI1.relateEle = this.oInput;
            this.oI2.relateEle = this.oInput;
        }

        NumCom.prototype.bindEvent = function(){
            var option = this.options;
            var self = this;
            this.oInput.addEventListener('input',function(ev){
                var val = this.value;
                val = val.replace(/[^\d]/g,'');
                this.value = val;
            },false);

            this.oInput.addEventListener('blur',function(ev){
                var val = this.value;
                if(!isInRange(val)){
                    val = option.MIN;
                }
                this.value = val;
                option.initValue = +val;
                toggleDisabled(val);
                if(option.cb && typeof option.cb == 'function'){
                    option.cb(option);
                }
            },false);

            this.oI1.addEventListener('click',function(){handler(this);},false);

            this.oI2.addEventListener('click',function(){handler(this,true);},false);

            function handler(context,flag){
                var val = option.initValue;
                if(!isInRange(val)){
                    val = option.MIN;
                    context.relateEle.value = val;
                    option.initValue = option.value = val;
                }else{
                    if((!flag && val >= option.MIN + option.step) || (flag && val <= option.MAX - option.step)){
                        val = flag ? val + option.step : val - option.step;
                        context.relateEle.value = val;
                        option.initValue = +val;
                        toggleDisabled(val);
                        if(option.cb && typeof option.cb == 'function'){
                            option.cb(option);
                        }
                    }
                }
            }

            function isInRange(x) {
                x = Number(x);
                if (x !== x){
                    return false;
                }
                return (x^0) === x && x >= option.MIN && x <= option.MAX;
            }

            function toggleDisabled(val){
                self.oI1.classList[val < option.MIN + option.step ? 'add' : 'remove']('disabled');
                self.oI2.classList[val > option.MAX - option.step ? 'add' : 'remove']('disabled');
            }

        }

        var plugin = {
            options:{
                MIN: 1,
                MAX: 99999,
                step: 1,
                initValue: 1,
                wrapper: document.body
            },
            init: function(options){
                Object.assign(this.options,options);
                this.render();
                this.bindEvent();
            },
            render: function(){
                var fragment = document.createDocumentFragment();
                this.oI1 = document.createElement('i');
                this.oI1.className = 'icon icon-minus disabled';
                fragment.appendChild(this.oI1);
                this.oInput = document.createElement('input');
                this.oInput.setAttribute('type','tel');
                this.oInput.setAttribute('value',this.options.initValue);
                this.oInput.setAttribute('maxlength',String(this.options.MAX).length);
                this.oInput.className = 'num';
                fragment.appendChild(this.oInput);
                this.oI2 = document.createElement('i');
                this.oI2.className = 'icon icon-plus';
                fragment.appendChild(this.oI2);
                this.options.wrapper.appendChild(fragment);
                this.oI1.relateEle = this.oInput;
                this.oI2.relateEle = this.oInput;
            },
            bindEvent: function(){
                var option = this.options;
                var self = this;
                this.oInput.addEventListener('input',function(ev){
                    var val = this.value;
                    val = val.replace(/[^\d]/g,'');
                    this.value = val;
                },false);

                this.oInput.addEventListener('blur',function(ev){
                    var val = this.value;
                    if(!isInRange(val)){
                        val = option.MIN;
                    }
                    this.value = val;
                    option.initValue = +val;
                    toggleDisabled(val);
                    if(option.cb && typeof option.cb == 'function'){
                        option.cb(option);
                    }
                },false);

                this.oI1.addEventListener('click',function(){handler(this);},false);

                this.oI2.addEventListener('click',function(){handler(this,true);},false);

                function handler(context,flag){
                    var val = option.initValue;
                    if(!isInRange(val)){
                        val = option.MIN;
                        context.relateEle.value = val;
                        option.initValue = option.value = val;
                    }else{
                        if((!flag && val >= option.MIN + option.step) || (flag && val <= option.MAX - option.step)){
                            val = flag ? val + option.step : val - option.step;
                            context.relateEle.value = val;
                            option.initValue = +val;
                            toggleDisabled(val);
                            if(option.cb && typeof option.cb == 'function'){
                                option.cb(option);
                            }
                        }
                    }
                }

                function isInRange(x) {
                    x = Number(x);
                    if (x !== x){
                        return false;
                    }
                    return (x^0) === x && x >= option.MIN && x <= option.MAX;
                }

                function toggleDisabled(val){
                    self.oI1.classList[val < option.MIN + option.step ? 'add' : 'remove']('disabled');
                    self.oI2.classList[val > option.MAX - option.step ? 'add' : 'remove']('disabled');
                }

            }
        }

        new NumCom({
            id: 3,
            wrapper:document.querySelector('.num-wrapper'),
            cb:function(obj){
                console.log(obj.id,obj.initValue);
            }
        });

        new NumCom({
            id: 4,
            wrapper:document.querySelectorAll('.num-wrapper')[1],
            initValue: 2,
            cb:function(obj){
                console.log(obj.id,obj.initValue);
            }
        });



    </script>
</body>

</html>
